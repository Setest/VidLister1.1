<?php/*	данный способ добавляет сниппеты динамически, см. как создаются плагины*/// create a handler for the directory$dir=$sources['snippets'];$handler = opendir($dir);// open directory and walk through the filenames$i=0;while ($file = readdir($handler)) {// if file isn't this directory or its parent, add it to the results	if ($file != "." && $file != ".." && is_file($dir.$file)) {		$i++;				$file_name = pathinfo($dir.$file, PATHINFO_FILENAME);		$file_ext = pathinfo($dir.$file, PATHINFO_EXTENSION);				// получаем описание к файлу		$desc_file=$dir."desc/".$file_name.".txt";		if (is_file($desc_file)){$desc = file_get_contents($desc_file);}		else {$desc = $file_name;}				// создаем сниппет		// $modx->log(modX::LOG_LEVEL_INFO,print_r($file,true));flush();		$modx->log(modX::LOG_LEVEL_INFO,"Description for snippet [$file_name]: $desc");flush();		$snippets[$i] = $modx->newObject('modSnippet');		$snippets[$i] -> fromArray(array(			'name' => $file_name,			'description' => $desc,			'snippet' => getFilePackagesContent($dir.$file),		),'',true,true);		// прикрепляем свойства		$properties = file_get_contents($dir.'properties/'.$file_name.'.json');		// $modx->log(modX::LOG_LEVEL_INFO,'PPP:'.$properties);flush();		if (!empty($properties)){			// $modx->log(modX::LOG_LEVEL_INFO,print_r($properties,true));flush();			$modx->log(modX::LOG_LEVEL_INFO,"Insert properties for snippet: [$file_name]");flush();			$snippets[$i]->setProperties(json_decode($properties,true)); // принимает только массив, вполне подходят экспортные параметры в UTF8-without BOM		}		unset($properties);	}}// tidy up: close the handlerclosedir($handler);return $snippets;